#!/usr/bin/env bash


# this function close every window controlled by
# the window-manager (to be used befor a Logout)
_killapps () {
    while read -r app; do
        wmctrl -i -c "$app"
    done < <(wmctrl -l | awk '{print $1}')
}

_launch () {
    NAME="$1"; COMMAND="$2"
    CHOICE=$(echo -e "Cancel\nConfirm" | dmenu -i -b -p $NAME | cut -d ':' -f 1)
    case "$CHOICE" in
        Cancel)
            exit 0
            ;;
        Confirm)
            _killapps
            $COMMAND
            ;;
        *)
            exit 1
            ;;
    esac
}


CHOICE=$(echo -e "Logout\nReboot\nShutdown\nLock" | dmenu -i -b -p QUIT | cut -d ':' -f 1)
case "$CHOICE" in
    Logout)
        # kill $(pgrep X) &
        _launch "LOGOUT" "killall i3"
        ;;
    Reboot)
        _launch "REBOOT" "systemctl reboot"
        ;;
    Shutdown)
        _launch "SHUTDOWN" "systemctl -i poweroff"
        ;;
    Lock)
        slock
        ;;
    *)
        exit 1
        ;;
esac
