#!/usr/bin/env bash

[[ "$*" == "" ]] && exit 1

FILE="$*"
MESS="/bin/less -R -~"
LIST="/bin/ls -ANgoh --ignore=".git" --group-directories-first --color=always"

# install source-highlight and use src-hilite-lesspipe.sh to preview
# with colors, otherwise /bin/cat will be used instead
[[ -f "/usr/share/source-highlight/src-hilite-lesspipe.sh" ]] \
    && PRINT="/usr/share/source-highlight/src-hilite-lesspipe.sh" \
    || PRINT="/bin/cat"

if [[ -L "$FILE" && -d "$FILE" ]]; then
    ${LIST} "$(readlink $FILE)" | ${MESS}
elif [[ -d "$FILE" ]]; then
    ${LIST} "$FILE" | ${MESS}
else
    # check the relative mime-type here:
    # https://www.iana.org/assignments/media-types/media-types.xhtml
    case $(file --mime-type "$FILE" -bL) in
        text/*)
            ${PRINT} "$FILE" | ${MESS}
            ;;
        *)
            ${MESS} "$FILE"
    esac
fi
