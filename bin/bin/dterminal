#!/usr/bin/env bash


_launch () {
    CHOICE=$(echo -e "Tile\nFloat" | dmenu -i -b -p WINDOW | cut -d ':' -f 1)
    case "$CHOICE" in
        Tile)
            "$1"
            ;;
        Float)
            $*
            ;;
    esac
}


if [[ -x "$(command -v uxterm)" ]]; then
    NAMES="Xterm"
fi

if [[ -x "$(command -v urxvt)" ]]; then
    [[ ! -n $NAMES ]] && NAMES="Urxvt" || NAMES="Urxvt\n"$NAMES
fi

if [[ -x "$(command -v st)" ]]; then
    [[ ! -n $NAMES ]] && NAMES="ST" || NAMES="ST\n"$NAMES
fi

if [[ -x "$(command -v kitty)" ]]; then
    GLX=$(glxinfo | awk '/OpenGL version/ {print $4}')
    if (( $(echo "$GLX > 3.3" | bc -l) )); then
        [[ ! -n $NAMES ]] && NAMES="Kitty" || NAMES="Kitty\n"$NAMES
    fi
fi

if [[ ! -n $NAMES ]]; then
    dmenu_run -i -b -p MENU
    exit 0
fi


CHOICE=$(echo -e "$NAMES" | dmenu -i -b -p TERMINAL | cut -d ':' -f 1)
case "$CHOICE" in
    Kitty)
        _launch "kitty" "--name scratchpad"
        ;;
    ST)
        _launch "st" "-n scratchpad"
        ;;
    Urxvt)
        _launch "urxvt" "-name scratchpad"
        ;;
    Xterm)
        _launch "xterm" "-name scratchpad"
        ;;
    *)
        exit 1
        ;;
esac
