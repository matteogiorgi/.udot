#!/usr/bin/env bash


_launch () {
    CHOICE=$(echo -e "$USER\nroot" | dmenu -i -b -p USER | cut -d ':' -f 1)
    case "$CHOICE" in
        $USER)
            "$*"
            ;;
        root)
            pkexec env DISPLAY=$DISPLAY XAUTHORITY=$XAUTHORITY "$*"
            ;;
    esac
}


if [[ -x "$(command -v qt5ct)" ]]; then
    NAMES="Qt5ct"
fi
if [[ -x "$(command -v lxappearance)" ]]; then
    [[ ! -n $NAMES ]] && NAMES="LXappearance" || NAMES="LXappearance\n"$NAMES
fi
if [[ -x "$(command -v arandr)" ]]; then
    [[ ! -n $NAMES ]] && NAMES="Arandr" || NAMES="Arandr\n"$NAMES
fi
if [[ -x "$(command -v pavucontrol)" ]]; then
    [[ ! -n $NAMES ]] && NAMES="Pavucontrol" || NAMES="Pavucontrol\n"$NAMES
fi
if [[ -x "$(command -v gparted)" ]]; then
    [[ ! -n $NAMES ]] && NAMES="GParted" || NAMES="GParted\n"$NAMES
fi

# check terminal list
if [[ -x "$(command -v uxterm)" ]]; then
    TERMIAL_NAMES="Xterm"
fi
if [[ -x "$(command -v urxvt)" ]]; then
    [[ ! -n $TERMIAL_NAMES ]] && TERMIAL_NAMES="Urxvt" || TERMIAL_NAMES="Urxvt\n"$TERMIAL_NAMES
fi
if [[ -x "$(command -v st)" ]]; then
    [[ ! -n $TERMIAL_NAMES ]] && TERMIAL_NAMES="ST" || TERMIAL_NAMES="ST\n"$TERMIAL_NAMES
fi
if [[ -x "$(command -v kitty)" ]]; then
    GLX=$(glxinfo | awk '/OpenGL version/ {print $4}')
    if (( $(echo "$GLX > 3.3" | bc -l) )); then
        [[ ! -n $TERMIAL_NAMES ]] && TERMIAL_NAMES="Kitty" || TERMIAL_NAMES="Kitty\n"$TERMIAL_NAMES
    fi
fi
if [[ -n $TERMIAL_NAMES ]]; then
    [[ ! -n $NAMES ]] && NAMES="Terminal" || NAMES="Terminal\n"$NAMES
fi
# end check terminal list

if [[ -x "$(command -v pcmanfm)" ]]; then
    [[ ! -n $NAMES ]] && NAMES="PCmanFm" || NAMES="PCmanFm\n"$NAMES
fi
if [[ ! -n $NAMES ]]; then
    dmenu_run -i -b -p MENU
    exit 0
fi


CHOICE=$(echo -e "$NAMES" | dmenu -i -b -p UTILITY | cut -d ':' -f 1)
case "$CHOICE" in
    PCmanFm)
        _launch "pcmanfm"
        ;;
    Terminal)
        TERMINAL_CHOICE=$(echo -e "$TERMIAL_NAMES" | dmenu -i -b -p TERMINAL | cut -d ':' -f 1)
        case "$TERMINAL_CHOICE" in
            Kitty)
                kitty
                ;;
            ST)
                st
                ;;
            Urxvt)
                urxvt
                ;;
            Xterm)
                xterm
                ;;
            *)
                exit 1
                ;;
        esac
        ;;
    GParted)
        gparted
        ;;
    Pavucontrol)
        pavucontrol
        ;;
    Arandr)
        arandr
        ;;
    LXappearance)
        _launch "lxappearance"
        ;;
    Qt5ct)
        _launch "qt5ct"
        ;;
    *)
        exit 1
        ;;
esac
