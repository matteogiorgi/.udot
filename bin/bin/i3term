#!/usr/bin/env bash

# This script control OpenGL drivers version before openining some
# terminal-emulators ordered by priority (kitty > urxvt > st).


GLX=$(glxinfo | awk '/OpenGL version/ {print $4}')

if [[ -x "$(command -v kitty)" && (( $(echo "$GLX > 3.3" | bc -l) )) ]]; then
    [[ $* == *--scratchpad* ]] && kitty --name scratchpad 2>/dev/null || kitty $* 2>/dev/null
elif [[ -x "$(command -v st)" ]]; then
    [[ $* == *--scratchpad* ]] && st -n scratchpad 2>/dev/null || st $* 2>/dev/null
elif [[ -x "$(command -v urxvt)" ]]; then
    [[ $* == *--scratchpad* ]] && urxvt -name scratchpad 2>/dev/null || urxvt $* 2>/dev/null
elif [[ -x "$(command -v xterm)" ]]; then
    [[ $* == *--scratchpad* ]] && xterm -name scratchpad 2>/dev/null || xterm $* 2>/dev/null
else
    i3-sensible-terminal $* 2>/dev/null
fi
