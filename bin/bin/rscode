#!/usr/bin/env bash


### Funcions and colors definition
##################################

add_codium_marketplace () {
cat 2>/dev/null > $HOME/.config/VSCodium/product.json <<-EOF
{
    "extensionsGallery": {
        "serviceUrl": "https://marketplace.visualstudio.com/_apis/public/gallery",
        "cacheUrl": "https://vscode.blob.core.windows.net/gallery/index",
        "itemUrl": "https://marketplace.visualstudio.com/items",
        "controlUrl": "",
        "recommendationsUrl": ""
    }
}
EOF
}

RED='\033[1;36m'
YLW='\033[1;35m'
NC='\033[0m'




### Choose editor
#################

if [[ -x "$(command -v codium)" ]]; then
    CODE="codium"
    FOLDER="VSCodium"
    NAMES="Codium\n"$NAMES
fi

if [[ -x "$(command -v code)" ]]; then
    CODE="code"
    FOLDER="Code"
    NAMES="Code\n"$NAMES
fi

if [[ ! -n $NAMES ]]; then
    printf "${YLW}%s${NC}\n" "WTF mate, Code/Codium are not installed!"
    exit 1
fi

if [[ -f "/bin/fzf" ]]; then
    case $(printf "$NAMES" | fzf --prompt="Choose editor to reset: " --height 100% --reverse --info=hidden --header-first) in
        Code)
            CODE="code"
            FOLDER="Code"
            ;;
        Codium)
            CODE="codium"
            FOLDER="VSCodium"
            add_codium_marketplace
            ;;
        *)
            exit 1
    esac
else
    clear
    printf "${RED}%s${NC}\n" "Choose editor to reset:"
    printf "%s${YLW}%s${NC}\n" "  (1) " "Code"
    printf "%s${YLW}%s${NC}\n" "  (2) " "Codium"
    printf "${RED}%s${NC} " "Enter an index (1-2):"

    while read response; do
        case $response in
            1)
                CODE="code"
                FOLDER="Code"
                break
                ;;
            2)
                CODE="codium"
                FOLDER="VSCodium"
                add_codium_marketplace
                break
                ;;
            *)
                printf "${RED}%s${NC} " "Enter an index (1-2):"
                ;;
        esac
    done
fi




### Remove extensions, add reinstall
####################################

LIST=$($CODE --list-extensions)
for EXTENSION in $LIST; do
    $CODE --uninstall-extension $EXTENSION
done

$CODE --install-extension vscodevim.vim
$CODE --install-extension monokai.theme-monokai-pro-vscode




### Reset VSCode settings
#########################

cat 2>/dev/null > $HOME/.config/$FOLDER/User/settings.json <<-EOF
{
    "keyboard.dispatch": "keyCode",
    "breadcrumbs.enabled": true,
    "telemetry.telemetryLevel": "off",
    "security.workspace.trust.startupPrompt": "never",
    "window.menuBarVisibility": "hidden",
    "window.restoreWindows": "all",
    "editor.fontFamily": "'JetBrains Mono', 'monospace'",
    "editor.fontLigatures": true,
    "editor.fontSize": 11,
    "editor.guides.indentation": false,
    "editor.minimap.enabled": false,
    "editor.rulers": [],
    "editor.folding": false,
    "editor.cursorBlinking": "solid",
    "editor.renderLineHighlight": "line",
    "editor.lineHeight": 1.4,
    "editor.lineNumbers": "relative",
    "editor.scrollbar.vertical": "auto",
    "editor.scrollbar.horizontal": "hidden",
    "editor.scrollbar.verticalScrollbarSize": 10,
    "editor.scrollbar.horizontalScrollbarSize": 0,
    "terminal.integrated.fontFamily": "'JetBrains Mono', 'monospace'",
    "terminal.integrated.fontSize": 12,
    "workbench.editor.showTabs": false,
    "workbench.startupEditor": "none",
    "workbench.colorTheme": "Monokai Pro",
    "workbench.iconTheme": "Monokai Pro Icons",
    "workbench.activityBar.visible": false,
    "workbench.sideBar.location": "left",
    "workbench.editor.enablePreview": false,
    "workbench.editor.closeEmptyGroups": true,
    "workbench.list.openMode": "singleClick",
    "workbench.tree.renderIndentGuides": "none",
    "workbench.tree.indent": 20,
    "vim.easymotion": true,
    "vim.incsearch": true,
    "vim.useSystemClipboard": true,
    "vim.useCtrlKeys": true,
    "vim.hlsearch": true,
    "vim.insertModeKeyBindings": [
        {
          "before": ["j", "j"],
          "after": ["<Esc>"]
        },
    ],
    "vim.visualModeKeyBindings": [
        {
            "before": ["<Tab>"],
            "commands": ["editor.action.indentLines"]
        },
        {
            "before": ["<S-Tab>"],
            "commands": ["editor.action.outdentLines"]
        },
    ],
    "vim.normalModeKeyBindingsNonRecursive": [
        {
          "before": ["<C-d>"],
          "after": ["<C-d>", "zz"]
        },
        {
          "before": ["<C-u>"],
          "after": ["<C-u>", "zz"]
        },
        {
          "before": ["<C-j>"],
          "after": ["}"]
        },
        {
          "before": ["<C-k>"],
          "after": ["{"]
        },
        {
          "before": ["Y"],
          "after": ["y", "$"]
        },
        {
            "before": ["u"],
            "commands": ["undo"],
            "silent": true
        },
        {
            "before": ["C-r"],
            "commands": ["redo"],
            "silent": true
        },
    ],
    "vim.leader": "<space>",
    "vim.handleKeys": {
        "<C-a>": false,
        "<C-f>": false
    },
}
EOF

cat 2>/dev/null > $HOME/.config/$FOLDER/User/keybindings.json <<-EOF
[
    {
        "key": "alt+d",
        "command": "toggleVim"
    },
    {
        "key": "alt+q",
        "command": "workbench.action.quit"
    },
    {
        "key": "alt+h",
        "command": "workbench.action.openRecent"
    },
    {
        "key": "alt+j",
        "command": "workbench.action.showCommands"
    },
    {
        "key": "alt+k",
        "command": "workbench.action.quickOpen"
    },
    {
        "key": "alt+l",
        "command": "workbench.action.focusSideBar",
        "when": "!sideBarFocus"
    },
    {
        "key": "alt+l",
        "command": "workbench.action.toggleSidebarVisibility",
        "when": "sideBarFocus"
    },
    {
        "key": "alt+space",
        "command": "editor.action.commentLine",
        "when": "editorTextFocus && !editorReadonly"
    },
    {
        "key": "alt+tab",
        "command": "workbench.action.quickOpenPreviousRecentlyUsedEditorInGroup",
        "when": "!activeEditorGroupEmpty"
    },
    {
        "key": "alt+tab",
        "command": "workbench.action.quickOpenNavigateNextInEditorPicker",
        "when": "inEditorsPicker && inQuickOpen"
    },
    {
        "key": "alt+shift+tab",
        "command": "workbench.action.quickOpenLeastRecentlyUsedEditorInGroup",
        "when": "!activeEditorGroupEmpty"
    },
    {
        "key": "alt+shift+tab",
        "command": "workbench.action.quickOpenNavigatePreviousInEditorPicker",
        "when": "inEditorsPicker && inQuickOpen"
    },
    {
        "key": "alt+Enter",
        "command": "workbench.action.terminal.toggleTerminal",
        "when": "terminal.active"
    },
    {
        "key": "alt+Enter",
        "command": "workbench.action.terminal.toggleTerminal",
        "when": "!terminal.active"
    },
    {
        "key": "ctrl+j",
        "command": "workbench.action.quickOpenSelectNext",
        "when": "inQuickOpen"
    },
    {
        "key": "ctrl+k",
        "command": "workbench.action.quickOpenSelectPrevious",
        "when": "inQuickOpen"
    },
    {
        "key": "ctrl+j",
        "command": "selectNextSuggestion",
        "when": "suggestWidgetMultipleSuggestions && suggestWidgetVisible && textInputFocus"
    },
    {
        "key": "ctrl+k",
        "command": "selectPrevSuggestion",
        "when": "suggestWidgetMultipleSuggestions && suggestWidgetVisible && textInputFocus"
    },
    {
        "key": "ctrl+j",
        "command": "showNextParameterHint",
        "when": "editorFocus && parameterHintsMultipleSignatures && parameterHintsVisible"
    },
    {
        "key": "ctrl+k",
        "command": "showPrevParameterHint",
        "when": "editorFocus && parameterHintsMultipleSignatures && parameterHintsVisible"
    },
]
EOF
