#!/usr/bin/env bash


### Funcions and colors definition
##################################

add_codium_marketplace () {
cat 2>/dev/null > $HOME/.config/VSCodium/product.json <<-EOF
{
    "extensionsGallery": {
        "serviceUrl": "https://marketplace.visualstudio.com/_apis/public/gallery",
        "cacheUrl": "https://vscode.blob.core.windows.net/gallery/index",
        "itemUrl": "https://marketplace.visualstudio.com/items",
        "controlUrl": "",
        "recommendationsUrl": ""
    }
}
EOF
}

RED='\033[1;36m'
YLW='\033[1;35m'
NC='\033[0m'




### Choose editor
#################

if [[ -x "$(command -v codium)" ]]; then
    CODE="codium"
    FOLDER="VSCodium"
    NAMES="Codium\n"$NAMES
fi

if [[ -x "$(command -v code)" ]]; then
    CODE="code"
    FOLDER="Code"
    NAMES="Code\n"$NAMES
fi

if [[ ! -n $NAMES ]]; then
    printf "${YLW}%s${NC}\n" "WTF mate, Code/Codium are not installed!"
    exit 1
fi

if [[ -f "/bin/fzf" ]]; then
    case $(printf "$NAMES" | fzf --prompt="Choose editor to reset: " --height 100% --reverse --info=hidden --header-first) in
        Code)
            CODE="code"
            FOLDER="Code"
            ;;
        Codium)
            CODE="codium"
            FOLDER="VSCodium"
            add_codium_marketplace
            ;;
        *)
            exit 1
    esac
else
    clear
    printf "${RED}%s${NC}\n" "Choose editor to reset:"
    printf "%s${YLW}%s${NC}\n" "  (1) " "Code"
    printf "%s${YLW}%s${NC}\n" "  (2) " "Codium"
    printf "${RED}%s${NC} " "Enter an index (1-2):"

    while read response; do
        case $response in
            1)
                CODE="code"
                FOLDER="Code"
                break
                ;;
            2)
                CODE="codium"
                FOLDER="VSCodium"
                add_codium_marketplace
                break
                ;;
            *)
                printf "${RED}%s${NC} " "Enter an index (1-2):"
                ;;
        esac
    done
fi




### Remove extensions, add reinstall
####################################

LIST=$($CODE --list-extensions)
for EXTENSION in $LIST; do
    $CODE --uninstall-extension $EXTENSION
done

$CODE --install-extension monokai.theme-monokai-pro-vscode




### Reset VSCode settings
#########################

cat 2>/dev/null > $HOME/.config/$FOLDER/User/settings.json <<-EOF
{
    "keyboard.dispatch": "keyCode",
    "breadcrumbs.enabled": true,
    "telemetry.telemetryLevel": "off",
    "security.workspace.trust.startupPrompt": "never",
    "window.menuBarVisibility": "hidden",
    "window.restoreWindows": "all",
    "editor.fontFamily": "'JetBrains Mono', 'monospace'",
    "editor.fontLigatures": true,
    "editor.fontSize": 11,
    "editor.guides.indentation": false,
    "editor.minimap.enabled": false,
    "editor.rulers": [],
    "editor.folding": false,
    "editor.cursorBlinking": "solid",
    "editor.renderLineHighlight": "gutter",
    "editor.lineHeight": 1.4,
    "editor.lineNumbers": "on",
    "editor.scrollbar.vertical": "auto",
    "editor.scrollbar.horizontal": "hidden",
    "editor.scrollbar.verticalScrollbarSize": 10,
    "editor.scrollbar.horizontalScrollbarSize": 0,
    "terminal.integrated.fontFamily": "'JetBrains Mono', 'monospace'",
    "terminal.integrated.fontSize": 12,
    "workbench.editor.showTabs": true,
    "workbench.startupEditor": "none",
    "workbench.colorTheme": "Monokai Pro",
    "workbench.iconTheme": "Monokai Pro Icons",
    "workbench.activityBar.visible": true,
    "workbench.sideBar.location": "left",
    "workbench.editor.enablePreview": false,
    "workbench.editor.closeEmptyGroups": true,
    "workbench.list.openMode": "singleClick",
    "workbench.tree.renderIndentGuides": "none",
    "workbench.tree.indent": 20,
}
EOF

cat 2>/dev/null > $HOME/.config/$FOLDER/User/keybindings.json <<-EOF
[
    {
        "key": "alt+space",
        "command": "editor.action.commentLine",
        "when": "editorTextFocus && !editorReadonly"
    },
]
EOF
