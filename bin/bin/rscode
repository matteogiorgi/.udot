#!/usr/bin/env bash


### Choose editor
#################

if [[ -f "/bin/fzf" ]]; then
    [[ -x "$(command -v codium)" ]] && NAMES="VSCodium\n"$NAMES
    [[ -x "$(command -v code)" ]] && NAMES="VSCode\n"$NAMES
elif [[ -x "$(command -v code)" ]]; then
    CODE="code"
    FOLDER="Code"
elif [[ -x "$(command -v codium)" ]]; then
    CODE="codium"
    FOLDER="VSCodium"
fi

if [[ -n $NAMES ]]; then
    case $(printf "$NAMES" | fzf --prompt="Choose editor to reset: " --height 100% --reverse --info=hidden --header-first) in
        VSCode)
            CODE="code"
            FOLDER="Code"
            ;;
        VSCodium)
            CODE="codium"
            FOLDER="VSCodium"
cat 2>/dev/null > $HOME/.config/VSCodium/product.json <<-EOF
{
    "extensionsGallery": {
        "serviceUrl": "https://marketplace.visualstudio.com/_apis/public/gallery",
        "cacheUrl": "https://vscode.blob.core.windows.net/gallery/index",
        "itemUrl": "https://marketplace.visualstudio.com/items",
        "controlUrl": "",
        "recommendationsUrl": ""
    }
}
EOF
            ;;
        *)
            exit 1
    esac
elif [[ ! -n $CODE ]]; then
    printf "VSCode/VSCodium not installed\n"
    exit 1
fi


### Remove extensions, add VSpaceCode
#####################################

LIST=$($CODE --list-extensions)
for EXTENSION in $LIST; do
    $CODE --uninstall-extension $EXTENSION
done

$CODE --install-extension vscodevim.vim
$CODE --install-extension monokai.theme-monokai-pro-vscode


### Reset VSCode settings
#########################

cat 2>/dev/null > $HOME/.config/$FOLDER/User/settings.json <<-EOF
{
    "keyboard.dispatch": "keyCode",
    "breadcrumbs.enabled": true,
    "telemetry.telemetryLevel": "off",
    "security.workspace.trust.startupPrompt": "never",
    "window.menuBarVisibility": "hidden",
    "window.restoreWindows": "all",
    "editor.fontFamily": "'JetBrains Mono', 'monospace'",
    "editor.fontLigatures": true,
    "editor.fontSize": 11,
    "editor.guides.indentation": false,
    "editor.minimap.enabled": false,
    "editor.rulers": [],
    "editor.folding": false,
    "editor.cursorBlinking": "solid",
    "editor.renderLineHighlight": "line",
    "editor.lineHeight": 1.4,
    "editor.lineNumbers": "relative",
    "editor.scrollbar.vertical": "auto",
    "editor.scrollbar.horizontal": "hidden",
    "editor.scrollbar.verticalScrollbarSize": 10,
    "editor.scrollbar.horizontalScrollbarSize": 0,
    "terminal.integrated.fontFamily": "'JetBrains Mono', 'monospace'",
    "terminal.integrated.fontSize": 12,
    "workbench.editor.showTabs": false,
    "workbench.startupEditor": "none",
    "workbench.colorTheme": "Monokai Pro",
    "workbench.iconTheme": "Monokai Pro Icons",
    "workbench.activityBar.visible": false,
    "workbench.sideBar.location": "left",
    "workbench.editor.enablePreview": false,
    "workbench.editor.closeEmptyGroups": true,
    "workbench.list.openMode": "singleClick",
    "workbench.tree.renderIndentGuides": "none",
    "workbench.tree.indent": 20,
    "vim.easymotion": true,
    "vim.useSystemClipboard": true,
    "vim.cursorStylePerMode.normal": "block",
    "vim.cursorStylePerMode.insert": "line",
    "vim.cursorStylePerMode.replace": "line",
    "vim.cursorStylePerMode.visual": "line",
    "vim.cursorStylePerMode.visualblock": "line",
    "vim.cursorStylePerMode.visualline": "line",
}
EOF

cat 2>/dev/null > $HOME/.config/$FOLDER/User/keybindings.json <<-EOF
[
    {
        "key": "alt+space",
        "command": "workbench.action.showCommands"
    },
    {
        "key": "alt+v",
        "command": "toggleVim"
    },
    {
        "key": "alt+t",
        "command": "workbench.action.terminal.toggleTerminal",
        "when": "terminal.active"
    },
    {
        "key": "alt+s",
        "command": "workbench.action.toggleSidebarVisibility"
    },
    {
        "key": "alt+h",
        "command": "workbench.action.openRecent"
    },
    {
        "key": "alt+j",
        "command": "workbench.action.quickOpen"
    },
    {
        "key": "alt+k",
        "command": "workbench.action.showAllEditorsByMostRecentlyUsed"
    },
    {
        "key": "alt+l",
        "command": "workbench.action.focusSideBar"
    },
    {
        "key": "ctrl+j",
        "command": "workbench.action.quickOpenSelectNext",
        "when": "inQuickOpen"
    },
    {
        "key": "ctrl+k",
        "command": "workbench.action.quickOpenSelectPrevious",
        "when": "inQuickOpen"
    },
    {
        "key": "ctrl+j",
        "command": "selectNextSuggestion",
        "when": "suggestWidgetMultipleSuggestions && suggestWidgetVisible && textInputFocus"
    },
    {
        "key": "ctrl+k",
        "command": "selectPrevSuggestion",
        "when": "suggestWidgetMultipleSuggestions && suggestWidgetVisible && textInputFocus"
    },
    {
        "key": "ctrl+j",
        "command": "showNextParameterHint",
        "when": "editorFocus && parameterHintsMultipleSignatures && parameterHintsVisible"
    },
    {
        "key": "ctrl+k",
        "command": "showPrevParameterHint",
        "when": "editorFocus && parameterHintsMultipleSignatures && parameterHintsVisible"
    }
]
EOF
