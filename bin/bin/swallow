#!/usr/bin/env bash


### Functions
#############

function xhide () {
    id=$(xdo id)
    xdo hide
    sh -c "$*" >/dev/null 2>&1
    xdo show "$id"
}

function xshow () {
    sh -c "$*" & disown >/dev/null 2>&1
}

function _vim () {
    [[ -f "/bin/xtermcontrol" ]] && BACKGROUND=$(xtermcontrol --get-bg 2>/dev/null) || BACKGROUND=""
    if [[ "$BACKGROUND" == "rgb:ffff/ffff/ffff" ]]; then
        env vim --cmd "let theme = 'light'" $@
    else
        env vim --cmd "let theme = 'dark'" $@
    fi
}




### Greppers
############

echo "$*" | grep "\.ar\." && {
    xhide xterm -e "${EDITOR:=vim}" "$*" &
    exit
}

echo "$1" | grep "\.sent$" && {
    xhide sent "$1" &
    exit
}




### MIME-type opener (inode/directory not necessary)
####################################################

case $(file --mime-type "$*" -bL) in
    audio/*)
        FILE=$*
        echo -e "PLAY: ${FILE##*/}\n¯¯¯¯"
        mpv "$FILE"
        ;;
    video/*)
        xhide "mpv --force-window '$*'"
        ;;
    application/pdf | application/postscript | application/djvu | image/vnd.djvu | application/epub+zip)
        xshow "zathura '$*'"
        ;;
    image/*)
        xshow "esxiv '$*'"
        ;;
    *)
        _vim "$*"
        ;;
esac
