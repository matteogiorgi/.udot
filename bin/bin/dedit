#!/usr/bin/env bash


_gvimlastsession () {
    if [[ -f "$HOME/.vim/sessions/last.vim" ]]; then
        gvim -S $HOME/.vim/sessions/last.vim
    else
        gvim
    fi
}

_launch () {
    NAME="$1"; COMMAND="$2"
    CHOICE=$(echo -e "Reopen\nOpen" | dmenu -i -b -p $NAME | cut -d ':' -f 1)
    case "$CHOICE" in
        Reopen)
            [[ "$NAME" == "GVIM" ]] && _gvimlastsession || $COMMAND
            ;;
        Open)
            [[ "$NAME" == "GVIM" ]] && $COMMAND || $COMMAND --new-window
            ;;
        *)
            exit 1
            ;;
    esac
}


if [[ -x "$(command -v codium)" ]]; then
    NAMES="Codium"
fi

if [[ -x "$(command -v code)" ]]; then
    [[ ! -n $NAMES ]] && NAMES="Code" || NAMES="Code\n"$NAMES
fi

if [[ -x "$(command -v gvim)" ]]; then
    [[ ! -n $NAMES ]] && NAMES="GVim" || NAMES="GVim\n"$NAMES
fi

if [[ ! -n $NAMES ]]; then
    dmenu_run -i -b -p MENU
    exit 0
fi


CHOICE=$(echo -e "$NAMES" | dmenu -i -b -p EDITOR | cut -d ':' -f 1)
case "$CHOICE" in
    Code)
        _launch "CODE" "code"
        ;;
    Codium)
        _launch "CODIUM" "codium"
        ;;
    GVim)
        _launch "GVIM" "gvim"
        ;;
    *)
        exit 1
        ;;
esac
